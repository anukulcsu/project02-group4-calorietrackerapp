Index: app/src/main/java/com/example/calorietracker/DashboardActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.calorietracker;\r\n\r\nimport android.annotation.SuppressLint;\r\nimport android.app.AlertDialog;\r\nimport android.content.Context;\r\nimport android.content.Intent;\r\nimport android.content.SharedPreferences;\r\nimport android.os.Bundle;\r\nimport android.text.InputType;\r\nimport android.widget.ArrayAdapter;\r\nimport android.widget.Button;\r\nimport android.widget.EditText;\r\nimport android.widget.ListView;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.activity.result.ActivityResultLauncher;\r\nimport androidx.activity.result.contract.ActivityResultContracts;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\n\r\nimport com.example.calorietracker.database.AppDatabase;\r\nimport com.example.calorietracker.database.User;\r\nimport com.example.calorietracker.database.UserDAO;\r\n\r\nimport java.util.ArrayList;\r\n\r\npublic class DashboardActivity extends AppCompatActivity {\r\n    private ActivityResultLauncher<Intent> addItemLauncher;\r\n    private ListView foodListView;\r\n    private TextView calorieCountView;\r\n    private TextView targetDisplayView;\r\n    private TextView comparisonView;\r\n    private ArrayList<String> foods;\r\n    private ArrayAdapter<String> adapter;\r\n    public ArrayList<String[]> history;\r\n\r\n    @SuppressLint(\"MissingInflatedId\")\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_dashboard);\r\n        createNotificationChannel();\r\n        db = AppDatabase.getInstance(this);\r\n        SharedPreferences preferences = getSharedPreferences(\"PROJECT2_PREFS\", Context.MODE_PRIVATE);\r\n        currentUserId = preferences.getInt(\"USER_ID\", -1);\r\n        boolean isAdmin = preferences.getBoolean(\"IS_ADMIN\", false);\r\n        foodListView = findViewById(R.id.foodList);\r\n        calorieCountView = findViewById(R.id.calorieCount);\r\n        targetDisplayView = findViewById(R.id.targetDisplay);\r\n        comparisonView = findViewById(R.id.comparison);\r\n        TextView loggedInUser = findViewById(R.id.userLoggedIn);\r\n        Button btnBackToAdmin = findViewById(R.id.btnBackToAdmin);\r\n        tvQuote = findViewById(R.id.tvQuote);\r\n        foodStrings = new ArrayList<>();\r\n        foodObjects = new ArrayList<>();\r\n        adapter = new ArrayAdapter<>(this, android.R.layout.simple_list_item_1, foodStrings);\r\n        foodListView.setAdapter(adapter);\r\n\r\n        loadUserData(loggedInUser);\r\n        loadFoodLogs();\r\n\r\n        tvQuote.setOnClickListener(v -> {\r\n            tvQuote.setText(\"Loading new motivation...\");\r\n            fetchQuote();\r\n        });\r\n        if (isAdmin) {\r\n            btnBackToAdmin.setVisibility(View.VISIBLE);\r\n            btnBackToAdmin.setOnClickListener(v -> {\r\n                Intent intent = IntentFactory.getLandingIntent(getApplicationContext());\r\n                intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_SINGLE_TOP);\r\n                startActivity(intent);\r\n                finish();\r\n            });\r\n        } else {\r\n            btnBackToAdmin.setVisibility(View.GONE);\r\n        }\r\n\r\n        history = new ArrayList<>();\r\n\r\n                        Intent intent = IntentFactory.getLoginIntent(DashboardActivity.this);\r\n                        intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);\r\n                        startActivity(intent);\r\n                        finish();\r\n                    })\r\n                    .setNegativeButton(\"Cancel\", null)\r\n                    .show();\r\n        });\r\n\r\n        // Remove list entries by tapping them\r\n        foodListView.setOnItemClickListener((parent, view, position, id) -> {\r\n            String selectedItem = foods.get(position);\r\n            String selectedItemName = selectedItem.substring(0, selectedItem.indexOf(\":\"));\r\n            new AlertDialog.Builder(DashboardActivity.this)\r\n                    .setTitle(\"Remove Item\")\r\n                    .setMessage(\"Would you like to remove \" + selectedItem.foodName + \"?\")\r\n                    .setPositiveButton(\"Yes\", (dialog, which) -> {\r\n                        int caloriesRemoved = retrieveCalories(selectedItem);\r\n                        if (caloriesRemoved != -1) {\r\n                            foods.remove(position);\r\n                            adapter.notifyDataSetChanged();\r\n                            int prevTotal = Integer.parseInt(calorieCountView.getText().toString().trim());\r\n                            int newTotal = prevTotal - caloriesRemoved;\r\n                            calorieCountView.setText(String.valueOf(newTotal));\r\n                            updateComparison(newTotal);\r\n                        } else {\r\n                            Toast.makeText(this, \"Error removing item!\", Toast.LENGTH_SHORT).show();\r\n                        }\r\n                    })\r\n                    .setNegativeButton(\"No\", (dialog, which) -> dialog.dismiss())\r\n                    .show();\r\n        });\r\n        Button editTargetButton = findViewById(R.id.editTarget);\r\n        editTargetButton.setOnClickListener(v -> {\r\n            TargetFragment fragment = new TargetFragment();\r\n            fragment.show(getSupportFragmentManager(), \"TargetFragment\");\r\n        });\r\n\r\n        int caloriesConsumed = Integer.parseInt(calorieCountView.getText().toString());\r\n        updateComparison(caloriesConsumed);\r\n\r\n        // Set/edit calorie target via pop-up from button\r\n        Button editTargetButton = findViewById(R.id.editTarget);\r\n        editTargetButton.setOnClickListener(v -> {\r\n            EditText input = new EditText(DashboardActivity.this);\r\n            input.setInputType(InputType.TYPE_CLASS_NUMBER);\r\n            new AlertDialog.Builder(DashboardActivity.this)\r\n                    .setTitle(\"Set Calorie Target\")\r\n                    .setMessage(\"Enter your daily calorie target\")\r\n                    .setView(input)\r\n                    .setPositiveButton(\"Set\", (dialog, which) -> {\r\n                        String targetStr = input.getText().toString().trim();\r\n                        if (!targetStr.isEmpty()) {\r\n                            try {\r\n                                int targetInt = Integer.parseInt(targetStr);\r\n                                if (targetInt > 99999) {\r\n                                    Toast.makeText(DashboardActivity.this, \"Limit is 99999!\", Toast.LENGTH_SHORT).show();\r\n                                    return;\r\n                                }\r\n                                targetDisplayView.setText(String.valueOf(targetInt));\r\n                                int calConsumed = Integer.parseInt(calorieCountView.getText().toString());\r\n                                updateComparison(calConsumed);\r\n                            } catch (NumberFormatException e) {\r\n                                Toast.makeText(DashboardActivity.this, \"Enter valid value\", Toast.LENGTH_SHORT).show();\r\n                            }\r\n                        }\r\n                    })\r\n                    .setNegativeButton(\"Cancel\", (dialog, which) -> dialog.dismiss()).show();\r\n        });\r\n        // Handles user-specified item properties from add item activity\r\n        addItemLauncher = registerForActivityResult(\r\n                new ActivityResultContracts.StartActivityForResult(),\r\n                result -> {\r\n                    if (result.getResultCode() == RESULT_OK && result.getData() != null) {\r\n                        Intent data = result.getData();\r\n                        String foodName = data.getStringExtra(\"foodName\");\r\n                        int calories = data.getIntExtra(\"calories\", 0);\r\n                        FoodLog newLog = new FoodLog(currentUserId, foodName, calories);\r\n                        db.getFoodLogDAO().insert(newLog);\r\n                        loadFoodLogs();\r\n                    }\r\n                }\r\n        );\r\n\r\n        Button addItemButton = findViewById(R.id.addItem);\r\n        addItemButton.setOnClickListener(v -> {\r\n            Intent intent = IntentFactory.getAddItemIntent(DashboardActivity.this);\r\n            addItemLauncher.launch(intent);\r\n        });\r\n\r\n        Button logCaloriesButton = findViewById(R.id.logCalories);\r\n        logCaloriesButton.setOnClickListener(v -> showDatePickerAndReset());\r\n\r\n        Button tipsButton = findViewById(R.id.historyButton);\r\n        tipsButton.setOnClickListener(v -> {\r\n            Intent intent = IntentFactory.getHistoryIntent(DashboardActivity.this);\r\n            startActivity(intent);\r\n        });\r\n        // \uD83D\uDD39 END TIPS BUTTON\r\n\r\n        TextView loggedInUser = findViewById(R.id.userLoggedIn);\r\n        // Display username of user currently logged in\r\n        SharedPreferences preferences = getSharedPreferences(\"PROJECT2_PREFS\", Context.MODE_PRIVATE);\r\n        int userId = preferences.getInt(\"USER_ID\", -1);\r\n        if (userId != -1) {\r\n            UserDAO dao = AppDatabase.getInstance(this).getUserDAO();\r\n            User user = dao.getUserById(String.valueOf(userId));\r\n            if (user != null) {\r\n                loggedInUser.setText(\"Logged in as: \" + user.getUsername());\r\n            }\r\n        }\r\n        // Allow user to sign out by clicking their username\r\n        loggedInUser.setOnClickListener(v -> {\r\n            new AlertDialog.Builder(DashboardActivity.this)\r\n                    .setTitle(\"Sign Out\")\r\n                    .setMessage(\"Do you want to sign out and return to login?\")\r\n                    .setPositiveButton(\"Yes\", (dialog, which) -> {\r\n                        Intent intent = new Intent(DashboardActivity.this, LoginActivity.class);\r\n                        startActivity(intent);\r\n                    })\r\n                    .setNegativeButton(\"No\", (dialog, which) -> dialog.dismiss())\r\n                    .show();\r\n        });\r\n    }\r\n\r\n    // Compares calories consumed to target and updates summary\r\n    private void updateComparison(int calories) {\r\n        int target = Integer.parseInt(targetDisplayView.getText().toString());\r\n        comparisonView.setText(getComparison(calories, target));\r\n    }\r\n\r\n    static String getComparison(int calories, int target) {\r\n        if (calories < target) {\r\n            return \"<\";\r\n        } else if (calories > target) {\r\n            return \">\";\r\n        } else {\r\n            return \"=\";\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public void onTargetSaved(int newTarget) {\r\n        targetDisplayView.setText(String.valueOf(newTarget));\r\n        String currentCals = calorieCountView.getText().toString();\r\n        if (!currentCals.isEmpty()) {\r\n            updateComparison(Integer.parseInt(currentCals));\r\n        }\r\n    }\r\n\r\n    private void fetchQuote() {\r\n        Retrofit retrofit = new Retrofit.Builder()\r\n                .baseUrl(\"https://dummyjson.com/\")\r\n                .addConverterFactory(GsonConverterFactory.create())\r\n                .build();\r\n\r\n        QuoteApi api = retrofit.create(QuoteApi.class);\r\n\r\n        api.getRandomQuote().enqueue(new Callback<Quote>() {\r\n            @Override\r\n            public void onResponse(Call<Quote> call, Response<Quote> response) {\r\n                if (response.isSuccessful() && response.body() != null) {\r\n                    tvQuote.setText(\"\\\"\" + response.body().quote + \"\\\"\\n- \" + response.body().author);\r\n                }\r\n            }\r\n\r\n            @Override\r\n            public void onFailure(Call<Quote> call, Throwable t) {\r\n                tvQuote.setText(\"Stay focused on your goals!\");\r\n            }\r\n        });\r\n    }\r\n\r\n    private void createNotificationChannel() {\r\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\r\n            String name = \"Goal Channel\";\r\n            String description = \"Channel for calorie goals\";\r\n            int importance = NotificationManager.IMPORTANCE_HIGH;\r\n            NotificationChannel channel = new NotificationChannel(CHANNEL_ID, name, importance);\r\n            channel.setDescription(description);\r\n            NotificationManager notificationManager = getSystemService(NotificationManager.class);\r\n            notificationManager.createNotificationChannel(channel);\r\n        }\r\n    }\r\n\r\n    private void sendGoalNotification() {\r\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.TIRAMISU) {\r\n            if (ActivityCompat.checkSelfPermission(this, android.Manifest.permission.POST_NOTIFICATIONS) != PackageManager.PERMISSION_GRANTED) {\r\n                ActivityCompat.requestPermissions(this, new String[]{android.Manifest.permission.POST_NOTIFICATIONS}, 101);\r\n                return;\r\n            }\r\n        }\r\n\r\n        int notificationId = (int) System.currentTimeMillis();\r\n\r\n        NotificationCompat.Builder builder = new NotificationCompat.Builder(this, CHANNEL_ID)\r\n                .setSmallIcon(android.R.drawable.ic_dialog_info)\r\n                .setContentTitle(\"Goal Reached! \uD83C\uDF89\")\r\n                .setContentText(\"Good job! You have hit your calorie target.\")\r\n                .setPriority(NotificationCompat.PRIORITY_HIGH)\r\n                .setDefaults(NotificationCompat.DEFAULT_ALL)\r\n                .setAutoCancel(true);\r\n\r\n        NotificationManagerCompat notificationManager = NotificationManagerCompat.from(this);\r\n        notificationManager.notify(notificationId, builder.build());\r\n    }\r\n\r\n    private void showDatePickerAndReset() {\r\n        final Calendar c = Calendar.getInstance();\r\n        int year = c.get(Calendar.YEAR);\r\n        int month = c.get(Calendar.MONTH);\r\n        int day = c.get(Calendar.DAY_OF_MONTH);\r\n\r\n        DatePickerDialog datePickerDialog = new DatePickerDialog(this,\r\n                (view, year1, month1, dayOfMonth) -> {\r\n                    String date = dayOfMonth + \"/\" + (month1 + 1) + \"/\" + year1;\r\n                    saveHistoryAndReset(date);\r\n                }, year, month, day);\r\n        datePickerDialog.show();\r\n    }\r\n\r\n    private void saveHistoryAndReset(String date) {\r\n        String currentCalsStr = calorieCountView.getText().toString();\r\n        String targetStr = targetDisplayView.getText().toString();\r\n        int total = currentCalsStr.isEmpty() ? 0 : Integer.parseInt(currentCalsStr);\r\n        int target = targetStr.isEmpty() ? 0 : Integer.parseInt(targetStr);\r\n\r\n        CalorieHistory history = new CalorieHistory(currentUserId, date, total, target);\r\n        db.getCalorieHistoryDAO().insert(history);\r\n        db.getFoodLogDAO().clearFoodsForUser(currentUserId);\r\n\r\n        isGoalNotified = false;\r\n        loadFoodLogs();\r\n        Toast.makeText(this, \"Logged for \" + date + \" and Resetted!\", Toast.LENGTH_SHORT).show();\r\n    }\r\n\r\n    private void loadFoodLogs() {\r\n        foodObjects.clear();\r\n        foodStrings.clear();\r\n        List<FoodLog> dbList = db.getFoodLogDAO().getFoodsForUser(currentUserId);\r\n        int totalCal = 0;\r\n        for (FoodLog f : dbList) {\r\n            foodObjects.add(f);\r\n            foodStrings.add(f.foodName + \": \" + f.calories + \" cal\");\r\n            totalCal += f.calories;\r\n        }\r\n        adapter.notifyDataSetChanged();\r\n        calorieCountView.setText(String.valueOf(totalCal));\r\n        updateComparison(totalCal);\r\n    }\r\n\r\n    private void updateTotalCalories() {\r\n        int total = 0;\r\n        for (FoodLog f : foodObjects) {\r\n            total += f.calories;\r\n        }\r\n        calorieCountView.setText(String.valueOf(total));\r\n        updateComparison(total);\r\n    }\r\n\r\n    private void updateComparison(int calories) {\r\n        String targetStr = targetDisplayView.getText().toString();\r\n        if(targetStr.isEmpty()) return;\r\n        int target = Integer.parseInt(targetStr);\r\n\r\n        String comparison = getComparison(calories, target);\r\n        comparisonView.setText(comparison);\r\n\r\n        if (calories >= target && !isGoalNotified) {\r\n            sendGoalNotification();\r\n            isGoalNotified = true;\r\n        }\r\n        if (calories < target) {\r\n            isGoalNotified = false;\r\n        }\r\n    }\r\n\r\n    private void loadUserData(TextView view) {\r\n        if (currentUserId != -1) {\r\n            User user = db.getUserDAO().getUserById(String.valueOf(currentUserId));\r\n            if (user != null) view.setText(\"Logged in as: \" + user.getUsername());\r\n        }\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/calorietracker/DashboardActivity.java b/app/src/main/java/com/example/calorietracker/DashboardActivity.java
--- a/app/src/main/java/com/example/calorietracker/DashboardActivity.java	(revision c604fe0109d7e0282c4ca187f3e81b852d987866)
+++ b/app/src/main/java/com/example/calorietracker/DashboardActivity.java	(date 1765428809520)
@@ -1,12 +1,12 @@
 package com.example.calorietracker;
 
 import android.annotation.SuppressLint;
-import android.app.AlertDialog;
 import android.content.Context;
 import android.content.Intent;
 import android.content.SharedPreferences;
 import android.os.Bundle;
 import android.text.InputType;
+import android.view.View;
 import android.widget.ArrayAdapter;
 import android.widget.Button;
 import android.widget.EditText;
